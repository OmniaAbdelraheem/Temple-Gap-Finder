<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temple Gap Finder - Advanced</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px 40px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #9E1B32 0%, #667eea 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-small {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-small:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-events {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 30px;
        }

        @media (max-width: 1200px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .card h2 {
            font-size: 1.8rem;
            color: #1f2937;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .time-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .time-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .time-group select {
            flex: 1;
        }

        .ampm-select {
            flex: 0.6 !important;
        }

        .time-separator {
            font-size: 1.5rem;
            font-weight: bold;
            color: #9ca3af;
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #9E1B32 0%, #667eea 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(158, 27, 50, 0.4);
        }

        .item-card {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 15px;
            position: relative;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .item-card:hover {
            border-color: #667eea;
            transform: translateX(5px);
        }

        .item-card h3 {
            color: #1f2937;
            font-size: 1.2rem;
            margin-bottom: 8px;
        }

        .item-card p {
            color: #6b7280;
            font-size: 0.95rem;
            margin: 4px 0;
        }

        .item-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 8px;
        }

        .badge-class {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-event {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-meeting {
            background: #dcfce7;
            color: #166534;
        }

        .delete-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #ef4444;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delete-btn:hover {
            background: #dc2626;
            transform: rotate(90deg);
        }

        .map-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 8px;
            transition: all 0.3s;
        }

        .map-btn:hover {
            background: #059669;
        }

        .gap-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 20px;
            color: white;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .gap-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }

        .suggestion-item {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            color: #1f2937;
        }

        .suggestion-item h4 {
            font-size: 1.1rem;
            margin-bottom: 6px;
            color: #111827;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: #1f2937;
        }

        .stat-card .label {
            font-size: 0.9rem;
            color: #6b7280;
            margin-top: 5px;
        }

        .day-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .day-btn {
            padding: 10px 20px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            white-space: nowrap;
        }

        .day-btn.active {
            background: linear-gradient(135deg, #9E1B32 0%, #667eea 100%);
            color: white;
            border-color: transparent;
        }

        .scroll-container {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .scroll-container::-webkit-scrollbar {
            width: 8px;
        }

        .scroll-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .scroll-container::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-content h2 {
            margin-bottom: 20px;
        }

        .close-modal {
            float: right;
            font-size: 2rem;
            cursor: pointer;
            color: #6b7280;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
        }

        .type-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .type-btn {
            padding: 12px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s;
        }

        .type-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #9ca3af;
        }

        .event-card {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .event-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(245, 158, 11, 0.4);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì Temple Gap Finder Pro</h1>
            <p>Smart schedule management with campus events and navigation</p>
            <div class="header-actions">
                <button class="btn-small" onclick="showRecurringModal()">üîÑ Copy Schedule</button>
                <button class="btn-small btn-secondary" onclick="exportSchedule()">üì§ Export</button>
                <button class="btn-small btn-secondary" onclick="importSchedule()">üì• Import</button>
                <button class="btn-small btn-events" onclick="showCampusEvents()">üéâ Events</button>
                <button class="btn-small btn-events" onclick="showCampusServices()">üèõÔ∏è Services</button>
                <button class="btn-small" onclick="showFoodOptions()">üçî Food</button>
                <button class="btn-small btn-secondary" onclick="showFitnessClasses()">üí™ Fitness</button>
                <button class="btn-small btn-events" onclick="getMyLocation()">üìç My Location</button>
                <button class="btn-small" onclick="showDietaryPreferences()">‚öôÔ∏è Food Filters</button>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <h2>‚ûï Add to Schedule</h2>
                
                <div class="type-selector">
                    <div class="type-btn active" onclick="selectType('class')" id="type-class">
                        üìö Class
                    </div>
                    <div class="type-btn" onclick="selectType('event')" id="type-event">
                        üéâ Event
                    </div>
                    <div class="type-btn" onclick="selectType('meeting')" id="type-meeting">
                        üë• Meeting
                    </div>
                </div>

                <div class="day-selector">
                    <button class="day-btn active" onclick="selectDay('Monday')">Mon</button>
                    <button class="day-btn" onclick="selectDay('Tuesday')">Tue</button>
                    <button class="day-btn" onclick="selectDay('Wednesday')">Wed</button>
                    <button class="day-btn" onclick="selectDay('Thursday')">Thu</button>
                    <button class="day-btn" onclick="selectDay('Friday')">Fri</button>
                </div>

                <form onsubmit="addItem(event)" id="addForm">
                    <div class="form-group">
                        <label id="nameLabel">Class Name</label>
                        <input type="text" id="itemName" placeholder="e.g., CIS 3296 - Software Design" required>
                    </div>

                    <div class="form-group">
                        <label>Time</label>
                        <div class="time-inputs">
                            <div>
                                <small style="color: #6b7280; display: block; margin-bottom: 5px;">Start Time</small>
                                <div class="time-group">
                                    <select id="startHour" required></select>
                                    <span class="time-separator">:</span>
                                    <select id="startMin" required></select>
                                    <select id="startAMPM" class="ampm-select" required>
                                        <option value="AM">AM</option>
                                        <option value="PM">PM</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <small style="color: #6b7280; display: block; margin-bottom: 5px;">End Time</small>
                                <div class="time-group">
                                    <select id="endHour" required></select>
                                    <span class="time-separator">:</span>
                                    <select id="endMin" required></select>
                                    <select id="endAMPM" class="ampm-select" required>
                                        <option value="AM">AM</option>
                                        <option value="PM">PM</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Location/Building</label>
                        <select id="building" required>
                            <option value="">Select location...</option>
                        </select>
                    </div>

                    <div class="form-group" id="notesGroup" style="display: none;">
                        <label>Notes (Optional)</label>
                        <textarea id="notes" rows="3" placeholder="Add any additional details..."></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary" id="submitBtn">‚ûï Add Class</button>
                </form>

                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 15px; color: #1f2937;">Today's Schedule</h3>
                    <div class="scroll-container" id="scheduleList"></div>
                </div>
            </div>

            <div>
                <div class="card" style="margin-bottom: 30px;">
                    <h2>üìä Overview</h2>
                    <div class="stats">
                        <div class="stat-card">
                            <div class="value" id="totalItems">0</div>
                            <div class="label">Total Items</div>
                        </div>
                        <div class="stat-card">
                            <div class="value" id="todayItems">0</div>
                            <div class="label">Today</div>
                        </div>
                        <div class="stat-card">
                            <div class="value" id="gapsFound">0</div>
                            <div class="label">Gaps</div>
                        </div>
                        <div class="stat-card">
                            <div class="value" id="campusEvents">0</div>
                            <div class="label">Campus Events</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>‚ö° Smart Gaps & Suggestions</h2>
                    <div class="scroll-container" id="gapsList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="recurringModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('recurringModal')">&times;</span>
            <h2>Copy Schedule to Other Days</h2>
            <p style="color: #6b7280; margin-bottom: 20px;">Select which days should have the same schedule as <strong id="copyFromDay">Monday</strong>:</p>
            <div class="checkbox-group">
                <input type="checkbox" id="copyMon" value="Monday">
                <label for="copyMon">Monday</label>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="copyTue" value="Tuesday">
                <label for="copyTue">Tuesday</label>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="copyWed" value="Wednesday">
                <label for="copyWed">Wednesday</label>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="copyThu" value="Thursday">
                <label for="copyThu">Thursday</label>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="copyFri" value="Friday">
                <label for="copyFri">Friday</label>
            </div>
            <button class="btn btn-primary" style="margin-top: 20px;" onclick="copySchedule()">Copy Schedule</button>
        </div>
    </div>

    <div id="eventsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('eventsModal')">&times;</span>
            <h2>üéâ Campus Events</h2>
            <p style="color: #6b7280; margin-bottom: 15px;">Live events from Temple NOW ‚Ä¢ <span id="lastUpdated"></span></p>
            <button onclick="refreshEvents()" style="margin-bottom: 20px; padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">üîÑ Refresh Events</button>
            <div id="eventsList"></div>
        </div>
    </div>

    <div id="servicesModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('servicesModal')">&times;</span>
            <h2>üèõÔ∏è Campus Services</h2>
            <div id="servicesList"></div>
        </div>
    </div>

    <div id="foodModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('foodModal')">&times;</span>
            <h2>üçî Food Options on Campus</h2>
            <p style="color: #6b7280; margin-bottom: 15px;">Order ahead or find nearby food spots</p>
            
            <div style="background: #f3f4f6; padding: 15px; border-radius: 12px; margin-bottom: 20px;">
                <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px;">
                    <button onclick="priceFilter='all'; showFoodOptions();" class="filter-btn" style="background: white; border: 2px solid #e5e7eb; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;">All Prices</button>
                    <button onclick="priceFilter='$'; showFoodOptions();" class="filter-btn" style="background: white; border: 2px solid #e5e7eb; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;">$ Cheap</button>
                    <button onclick="priceFilter='$$'; showFoodOptions();" class="filter-btn" style="background: white; border: 2px solid #e5e7eb; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;">$$ Mid</button>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="mealPlanFilter" onchange="mealPlanOnly=this.checked; showFoodOptions();">
                    <label for="mealPlanFilter" style="color: #374151; font-weight: 600;">Accepts Meal Plan Only</label>
                </div>
            </div>
            
            <div id="foodList"></div>
        </div>
    </div>

    <div id="dietaryModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('dietaryModal')">&times;</span>
            <h2>üçΩÔ∏è Dietary Preferences</h2>
            <p style="color: #6b7280; margin-bottom: 20px;">Select your dietary restrictions to filter food options</p>
            
            <div class="checkbox-group">
                <input type="checkbox" id="halalCheck" onchange="dietaryPreferences.halal=this.checked">
                <label for="halalCheck">üïå Halal</label>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="kosherCheck" onchange="dietaryPreferences.kosher=this.checked">
                <label for="kosherCheck">‚ú°Ô∏è Kosher</label>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="vegetarianCheck" onchange="dietaryPreferences.vegetarian=this.checked">
                <label for="vegetarianCheck">ü•ó Vegetarian</label>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="veganCheck" onchange="dietaryPreferences.vegan=this.checked">
                <label for="veganCheck">üå± Vegan</label>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="glutenFreeCheck" onchange="dietaryPreferences.glutenFree=this.checked">
                <label for="glutenFreeCheck">üåæ Gluten-Free</label>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="dairyFreeCheck" onchange="dietaryPreferences.dairyFree=this.checked">
                <label for="dairyFreeCheck">ü•õ Dairy-Free</label>
            </div>
            
            <button class="btn btn-primary" style="margin-top: 20px;" onclick="closeModal('dietaryModal'); showFoodOptions();">Apply Filters</button>
        </div>
    </div>

    <div id="fitnessModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('fitnessModal')">&times;</span>
            <h2>üí™ Group Fitness Classes</h2>
            <p style="color: #6b7280; margin-bottom: 15px;">Weekly schedule from Campus Recreation</p>
            <button onclick="refreshFitnessClasses()" style="margin-bottom: 20px; padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">üîÑ Refresh Schedule</button>
            <div id="fitnessList"></div>
        </div>
    </div>

    <script>
        let schedule = {};
        let currentDay = 'Monday';
        let currentType = 'class';
        let userLocation = null;
        let cachedEvents = null;
        let lastEventFetch = null;
        let dietaryPreferences = {
            halal: false,
            kosher: false,
            vegetarian: false,
            vegan: false,
            glutenFree: false,
            dairyFree: false
        };
        let priceFilter = 'all'; // 'all', '$', '$$'
        let mealPlanOnly = false;

        const templeBuildings = [
            "Anderson Hall", "Annenberg Hall", "Barton Hall", "Beury Hall",
            "Charles Library", "Gladfelter Hall", "Howard Gittis Student Center",
            "Liacouras Center", "Morgan Hall", "Paley Library", "Pearson Hall",
            "Ritter Hall", "SERC", "Speakman Hall", "Tuttleman Learning Center",
            "Weiss Hall", "Online/Zoom", "Off Campus"
        ];

        const buildingCoords = {
            "Anderson Hall": "39.9812,-75.1556",
            "Charles Library": "39.9813,-75.1551",
            "SERC": "39.9805,-75.1550",
            "Howard Gittis Student Center": "39.9810,-75.1555",
            "Gladfelter Hall": "39.9815,-75.1560"
        };

        const campusServices = [
            {
                name: "Career Center",
                description: "Resume help, interview prep, job search assistance",
                location: "Mitten Hall, 3rd Floor",
                hours: "Mon-Fri: 9 AM - 5 PM",
                bookingUrl: "https://temple.joinhandshake.com/",
                phone: "(215) 204-7676",
                services: ["Resume Reviews", "Mock Interviews", "Career Counseling", "Job Search"]
            },
            {
                name: "Counseling Services",
                description: "Mental health support and wellness resources",
                location: "Tuttleman Counseling Services",
                hours: "Mon-Fri: 8:30 AM - 5 PM",
                bookingUrl: "https://studentaffairs.temple.edu/counseling",
                phone: "(215) 204-7276",
                services: ["Individual Therapy", "Group Therapy", "Crisis Support"]
            },
            {
                name: "Writing Center",
                description: "Free writing tutoring for all students",
                location: "Anderson Hall, 4th Floor",
                hours: "Mon-Thu: 10 AM - 6 PM, Fri: 10 AM - 2 PM",
                bookingUrl: "https://writingcenter.temple.edu/",
                phone: "(215) 204-5039",
                services: ["Essay Help", "Grammar Review", "Citation Assistance"]
            }
        ];

        const foodPlaces = [
            {
                name: "Student Center Food Court",
                type: "Food Court",
                location: "Howard Gittis Student Center",
                hours: "Mon-Fri: 7 AM - 8 PM",
                orderUrl: null,
                phone: "(215) 204-7944",
                options: ["Chick-fil-A", "Subway", "Panda Express", "Starbucks"],
                priceRange: "$",
                mealPlan: true,
                dietary: ["halal", "vegetarian"]
            },
            {
                name: "Chipotle",
                type: "Mexican",
                location: "1837 Liacouras Walk",
                hours: "10:45 AM - 10 PM",
                orderUrl: "https://www.chipotle.com/order",
                phone: "(215) 787-9838",
                options: ["Burritos", "Bowls", "Tacos"],
                priceRange: "$",
                mealPlan: false,
                dietary: ["vegetarian", "vegan", "dairyFree", "glutenFree"]
            },
            {
                name: "Honeygrow",
                type: "Healthy/Stir-fry",
                location: "1801 Liacouras Walk",
                hours: "10:30 AM - 10 PM",
                orderUrl: "https://www.honeygrow.com/order/",
                phone: "(267) 639-3689",
                options: ["Stir-fry", "Salads", "Honeybar"],
                priceRange: "$",
                mealPlan: false,
                dietary: ["vegetarian", "vegan", "glutenFree", "dairyFree"]
            },
            {
                name: "Richie's",
                type: "Quick Service",
                location: "Morgan Hall",
                hours: "Mon-Fri: 7:30 AM - 3 PM",
                orderUrl: null,
                phone: null,
                options: ["Sandwiches", "Snacks", "Drinks"],
                priceRange: "$",
                mealPlan: true,
                dietary: ["vegetarian"]
            },
            {
                name: "Saxbys Coffee",
                type: "Coffee Shop",
                location: "Charles Library",
                hours: "Mon-Fri: 7 AM - 7 PM",
                orderUrl: "https://www.saxbyscoffee.com/mobile-app",
                phone: "(215) 204-9862",
                options: ["Coffee", "Pastries", "Light Snacks"],
                priceRange: "$",
                mealPlan: true,
                dietary: ["vegetarian"]
            },
            {
                name: "Insomnia Cookies",
                type: "Dessert",
                location: "1900 N 13th St",
                hours: "11 AM - 3 AM",
                orderUrl: "https://insomniacookies.com/",
                phone: "(215) 291-9448",
                options: ["Cookies", "Ice Cream", "Brownies"],
                priceRange: "$",
                mealPlan: false,
                dietary: ["vegetarian"]
            },
            {
                name: "Dunkin'",
                type: "Coffee/Breakfast",
                location: "Liacouras Walk",
                hours: "5 AM - 9 PM",
                orderUrl: "https://www.dunkindonuts.com/en/mobile-app",
                phone: null,
                options: ["Coffee", "Donuts", "Breakfast Sandwiches"],
                priceRange: "$",
                mealPlan: false,
                dietary: ["vegetarian"]
            },
            {
                name: "Qdoba",
                type: "Mexican",
                location: "Student Center",
                hours: "Mon-Fri: 10 AM - 8 PM",
                orderUrl: "https://www.qdoba.com/order",
                phone: null,
                options: ["Burritos", "Bowls", "Quesadillas"],
                priceRange: "$",
                mealPlan: true,
                dietary: ["vegetarian", "vegan", "dairyFree", "glutenFree"]
            },
            {
                name: "Halal Cart (13th & Montgomery)",
                type: "Street Food",
                location: "13th & Montgomery",
                hours: "11 AM - 3 AM",
                orderUrl: null,
                phone: null,
                options: ["Chicken over Rice", "Lamb Gyro", "Falafel"],
                priceRange: "$",
                mealPlan: false,
                dietary: ["halal"]
            },
            {
                name: "Maxi's",
                type: "Deli",
                location: "1234 N Broad St",
                hours: "Mon-Sat: 6 AM - 8 PM",
                orderUrl: null,
                phone: "(215) 787-9500",
                options: ["Sandwiches", "Salads", "Breakfast"],
                priceRange: "$",
                mealPlan: false,
                dietary: ["halal", "vegetarian"]
            },
            {
                name: "Richie's (Anderson Hall)",
                type: "Cafe",
                location: "Anderson Hall",
                hours: "Mon-Fri: 7:30 AM - 3 PM",
                orderUrl: null,
                phone: null,
                options: ["Coffee", "Sandwiches", "Snacks"],
                priceRange: "$",
                mealPlan: true,
                dietary: ["vegetarian"]
            },
            {
                name: "Shake Shack",
                type: "Burgers",
                location: "1500 Liacouras Walk",
                hours: "11 AM - 11 PM",
                orderUrl: "https://www.shakeshack.com/",
                phone: null,
                options: ["Burgers", "Fries", "Shakes"],
                priceRange: "$$",
                mealPlan: false,
                dietary: ["vegetarian"]
            },
            {
                name: "Roti Modern Mediterranean",
                type: "Mediterranean",
                location: "Broad Street",
                hours: "10:30 AM - 10 PM",
                orderUrl: "https://roti.com/order/",
                phone: null,
                options: ["Rice Plates", "Salads", "Pita Sandwiches"],
                priceRange: "$",
                mealPlan: false,
                dietary: ["halal", "vegetarian", "vegan", "glutenFree"]
            },
            {
                name: "Wendy's",
                type: "Fast Food",
                location: "Broad Street",
                hours: "10 AM - 11 PM",
                orderUrl: null,
                phone: null,
                options: ["Burgers", "Chicken Sandwiches", "Fries"],
                priceRange: "$",
                mealPlan: false,
                dietary: ["vegetarian"]
            },
            {
                name: "Saladworks",
                type: "Salads/Healthy",
                location: "Student Center",
                hours: "Mon-Fri: 10 AM - 7 PM",
                orderUrl: "https://www.saladworks.com/",
                phone: null,
                options: ["Salads", "Wraps", "Grain Bowls"],
                priceRange: "$",
                mealPlan: true,
                dietary: ["vegetarian", "vegan", "glutenFree", "dairyFree"]
            },
            {
                name: "Twisted Lizard",
                type: "Mexican",
                location: "Montgomery Avenue",
                hours: "11 AM - 10 PM",
                orderUrl: null,
                phone: "(215) 769-0555",
                options: ["Tacos", "Burritos", "Quesadillas"],
                priceRange: "$",
                mealPlan: false,
                dietary: ["vegetarian", "vegan"]
            },
            {
                name: "Panda Express",
                type: "Chinese",
                location: "Student Center",
                hours: "Mon-Fri: 10 AM - 8 PM",
                orderUrl: "https://www.pandaexpress.com/",
                phone: null,
                options: ["Orange Chicken", "Fried Rice", "Chow Mein"],
                priceRange: "$",
                mealPlan: true,
                dietary: ["vegetarian"]
            },
            {
                name: "Subway",
                type: "Sandwiches",
                location: "Student Center",
                hours: "Mon-Fri: 9 AM - 8 PM",
                orderUrl: "https://www.subway.com/",
                phone: null,
                options: ["Subs", "Salads", "Wraps"],
                priceRange: "$",
                mealPlan: true,
                dietary: ["halal", "vegetarian", "vegan"]
            },
            {
                name: "Chick-fil-A",
                type: "Chicken",
                location: "Student Center",
                hours: "Mon-Fri: 7 AM - 7 PM",
                orderUrl: "https://www.chick-fil-a.com/",
                phone: null,
                options: ["Chicken Sandwiches", "Nuggets", "Waffle Fries"],
                priceRange: "$",
                mealPlan: true,
                dietary: ["glutenFree"]
            },
            {
                name: "Starbucks (Student Center)",
                type: "Coffee",
                location: "Student Center",
                hours: "Mon-Fri: 7 AM - 8 PM",
                orderUrl: "https://www.starbucks.com/",
                phone: null,
                options: ["Coffee", "Tea", "Sandwiches"],
                priceRange: "$$",
                mealPlan: true,
                dietary: ["vegetarian", "vegan", "dairyFree"]
            },
            {
                name: "7-Eleven",
                type: "Convenience",
                location: "Multiple locations",
                hours: "24/7",
                orderUrl: "https://www.7eleven.com/7rewards",
                phone: null,
                options: ["Snacks", "Drinks", "Hot Food"],
                priceRange: "$",
                mealPlan: false,
                dietary: ["vegetarian"]
            },
            {
                name: "The Diamond Grille",
                type: "American",
                location: "Morgan Hall South",
                hours: "Mon-Fri: 7 AM - 3 PM",
                orderUrl: null,
                phone: null,
                options: ["Breakfast", "Burgers", "Sandwiches"],
                priceRange: "$",
                mealPlan: true,
                dietary: ["vegetarian"]
            },
            {
                name: "Pizza Hut Express",
                type: "Pizza",
                location: "Near Campus",
                hours: "11 AM - 10 PM",
                orderUrl: "https://www.pizzahut.com/",
                phone: null,
                options: ["Pizza", "Wings", "Breadsticks"],
                priceRange: "$",
                mealPlan: false,
                dietary: ["vegetarian"]
            }
        ];

        function init() {
            loadSchedule();
            populateTimeSelects();
            populateBuildings();
            updateDisplay();
            fetchCampusEvents();
        }

        function loadSchedule() {
            const saved = localStorage.getItem('templeSchedulePro');
            if (saved) {
                try {
                    schedule = JSON.parse(saved);
                } catch (e) {
                    schedule = {};
                }
            }
        }

        function saveSchedule() {
            localStorage.setItem('templeSchedulePro', JSON.stringify(schedule));
        }

        function populateTimeSelects() {
            const hours = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'];
            const minutes = Array.from({length: 60}, (_, i) => i.toString().padStart(2, '0'));

            ['startHour', 'endHour'].forEach(id => {
                const select = document.getElementById(id);
                hours.forEach(h => {
                    const opt = document.createElement('option');
                    opt.value = h;
                    opt.textContent = h;
                    select.appendChild(opt);
                });
            });

            ['startMin', 'endMin'].forEach(id => {
                const select = document.getElementById(id);
                minutes.forEach(m => {
                    const opt = document.createElement('option');
                    opt.value = m;
                    opt.textContent = m;
                    select.appendChild(opt);
                });
            });

            document.getElementById('startHour').value = '9';
            document.getElementById('startMin').value = '00';
            document.getElementById('endHour').value = '10';
            document.getElementById('endMin').value = '50';
        }

        function populateBuildings() {
            const select = document.getElementById('building');
            templeBuildings.forEach(b => {
                const opt = document.createElement('option');
                opt.value = b;
                opt.textContent = b;
                select.appendChild(opt);
            });
        }

        function selectDay(day) {
            currentDay = day;
            document.querySelectorAll('.day-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent === day.substring(0, 3));
            });
            updateDisplay();
        }

        function selectType(type) {
            currentType = type;
            document.querySelectorAll('.type-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`type-${type}`).classList.add('active');

            const labels = {
                'class': 'Class Name',
                'event': 'Event Name',
                'meeting': 'Meeting Title'
            };
            const buttons = {
                'class': '‚ûï Add Class',
                'event': '‚ûï Add Event',
                'meeting': '‚ûï Add Meeting'
            };

            document.getElementById('nameLabel').textContent = labels[type];
            document.getElementById('submitBtn').textContent = buttons[type];
            document.getElementById('notesGroup').style.display = type !== 'class' ? 'block' : 'none';
        }

        function convertTo24Hour(hour, minute, ampm) {
            let h = parseInt(hour);
            if (ampm === 'PM' && h !== 12) h += 12;
            if (ampm === 'AM' && h === 12) h = 0;
            return `${h.toString().padStart(2, '0')}:${minute}`;
        }

        function convertTo12Hour(time24) {
            const [h, m] = time24.split(':');
            let hour = parseInt(h);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            if (hour > 12) hour -= 12;
            if (hour === 0) hour = 12;
            return `${hour}:${m} ${ampm}`;
        }

        function addItem(e) {
            e.preventDefault();
            
            const start24 = convertTo24Hour(
                document.getElementById('startHour').value,
                document.getElementById('startMin').value,
                document.getElementById('startAMPM').value
            );

            const end24 = convertTo24Hour(
                document.getElementById('endHour').value,
                document.getElementById('endMin').value,
                document.getElementById('endAMPM').value
            );

            const item = {
                name: document.getElementById('itemName').value,
                start: start24,
                end: end24,
                building: document.getElementById('building').value,
                type: currentType,
                notes: document.getElementById('notes').value || ''
            };

            if (timeToMinutes(end24) <= timeToMinutes(start24)) {
                alert('End time must be after start time!');
                return;
            }

            if (!schedule[currentDay]) schedule[currentDay] = [];
            schedule[currentDay].push(item);
            
            saveSchedule();
            e.target.reset();
            document.getElementById('startHour').value = '9';
            document.getElementById('startMin').value = '00';
            document.getElementById('endHour').value = '10';
            document.getElementById('endMin').value = '50';
            updateDisplay();
        }

        function deleteItem(day, index) {
            if (confirm('Delete this item?')) {
                schedule[day].splice(index, 1);
                saveSchedule();
                updateDisplay();
            }
        }

        function openMaps(building) {
            const coords = buildingCoords[building];
            if (coords) {
                const url = userLocation 
                    ? `https://www.google.com/maps/dir/${userLocation}/${coords}`
                    : `https://www.google.com/maps/search/?api=1&query=${coords}`;
                window.open(url, '_blank');
            } else {
                window.open(`https://www.google.com/maps/search/?api=1&query=Temple+University+${encodeURIComponent(building)}`, '_blank');
            }
        }

        function getMyLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        userLocation = `${position.coords.latitude},${position.coords.longitude}`;
                        alert('‚úÖ Location saved! You can now get directions to buildings.');
                    },
                    () => alert('‚ùå Could not get your location. Please enable location services.')
                );
            } else {
                alert('‚ùå Geolocation is not supported by your browser.');
            }
        }

        function updateDisplay() {
            updateStats();
            displaySchedule();
            displayGaps();
        }

        function updateStats() {
            const total = Object.values(schedule).reduce((sum, items) => sum + items.length, 0);
            const today = schedule[currentDay]?.length || 0;
            const gaps = findGaps().length;

            document.getElementById('totalItems').textContent = total;
            document.getElementById('todayItems').textContent = today;
            document.getElementById('gapsFound').textContent = gaps;
        }

        function displaySchedule() {
            const container = document.getElementById('scheduleList');
            const items = schedule[currentDay] || [];

            if (items.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No items scheduled for this day</p></div>';
                return;
            }

            const sorted = [...items].sort((a, b) => timeToMinutes(a.start) - timeToMinutes(b.start));
            const badges = { 'class': 'badge-class', 'event': 'badge-event', 'meeting': 'badge-meeting' };
            const icons = { 'class': 'üìö', 'event': 'üéâ', 'meeting': 'üë•' };
            
            container.innerHTML = sorted.map((item, i) => {
                const actualIndex = items.indexOf(item);
                return `
                    <div class="item-card">
                        <button class="delete-btn" onclick="deleteItem('${currentDay}', ${actualIndex})">√ó</button>
                        <h3>${icons[item.type]} ${item.name}</h3>
                        <p>üïê ${convertTo12Hour(item.start)} - ${convertTo12Hour(item.end)}</p>
                        <p>üìç ${item.building}</p>
                        ${item.notes ? `<p style="font-style: italic;">üí≠ ${item.notes}</p>` : ''}
                        <span class="item-badge ${badges[item.type]}">${item.type.toUpperCase()}</span>
                        ${buildingCoords[item.building] || item.building !== 'Online/Zoom' ? 
                            `<button class="map-btn" onclick="openMaps('${item.building}')">üó∫Ô∏è Get Directions</button>` : ''}
                    </div>
                `;
            }).join('');
        }

        function findGaps() {
            const items = schedule[currentDay] || [];
            if (items.length < 2) return [];

            const sorted = [...items].sort((a, b) => timeToMinutes(a.start) - timeToMinutes(b.start));
            const gaps = [];

            for (let i = 0; i < sorted.length - 1; i++) {
                const gapMins = timeToMinutes(sorted[i + 1].start) - timeToMinutes(sorted[i].end);
                if (gapMins >= 15) {
                    gaps.push({
                        start: sorted[i].end,
                        end: sorted[i + 1].start,
                        minutes: gapMins,
                        afterItem: sorted[i].name,
                        beforeItem: sorted[i + 1].name,
                        fromBuilding: sorted[i].building,
                        toBuilding: sorted[i + 1].building
                    });
                }
            }
            return gaps;
        }

        function timeToMinutes(time) {
            const [h, m] = time.split(':').map(Number);
            return h * 60 + m;
        }

        function displayGaps() {
            const container = document.getElementById('gapsList');
            const gaps = findGaps();

            if (gaps.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>‚ú® No gaps found today!<br>Your schedule is perfectly packed.</p></div>';
                return;
            }

            container.innerHTML = gaps.map(gap => {
                const suggestions = getSuggestions(gap);
                const suggestionHTML = suggestions.map(group => `
                    <div style="margin-bottom: 15px;">
                        <h4 style="color: white; font-size: 1.1rem; margin-bottom: 10px;">${group.title}</h4>
                        ${group.items.map(item => `
                            <div class="suggestion-item">
                                <h4>${item.name}</h4>
                                <p>üìç ${item.location} ${item.distance ? `‚Ä¢ üö∂ ${item.distance}` : ''}</p>
                                <p style="color: #9ca3af; font-style: italic;">${item.details}</p>
                            </div>
                        `).join('')}
                    </div>
                `).join('');

                return `
                    <div class="gap-card">
                        <div class="gap-header">
                            <h3>‚ö° ${gap.minutes} Minute Gap</h3>
                            <div style="font-size: 0.95rem; opacity: 0.9; line-height: 1.6;">
                                üïê ${convertTo12Hour(gap.start)} - ${convertTo12Hour(gap.end)}<br>
                                Between: ${gap.afterItem} ‚Üí ${gap.beforeItem}<br>
                                üìç From ${gap.fromBuilding} to ${gap.toBuilding}
                            </div>
                        </div>
                        ${suggestionHTML}
                    </div>
                `;
            }).join('');
        }

        function getSuggestions(gap) {
            const hour = parseInt(gap.start.split(':')[0]);
            const suggestions = [];
            
            if (hour >= 11 && hour <= 14 && gap.minutes >= 30) {
                suggestions.push({
                    title: 'üçΩÔ∏è Lunch Time',
                    items: [
                        {name: "Student Center Food Court", location: "Howard Gittis", distance: "2 min walk", details: "Perfect time for a meal break"},
                        {name: "Honeygrow", location: "Liacouras Walk", distance: "5 min walk", details: "Healthy options available"},
                        {name: "Chipotle", location: "Liacouras Walk", distance: "4 min walk", details: "Quick & filling"}
                    ]
                });
            } else if (gap.minutes >= 60) {
                suggestions.push({
                    title: 'üìö Study Session',
                    items: [
                        {name: "Charles Library", location: "Main Campus", distance: "3 min walk", details: "Focus time with good amenities"},
                        {name: "SERC Study Rooms", location: "SERC Building", distance: "4 min walk", details: "Quiet collaborative spaces"}
                    ]
                });
            } else if (gap.minutes >= 30) {
                suggestions.push({
                    title: '‚òï Coffee & Quick Study',
                    items: [
                        {name: "Saxbys at Charles", location: "Charles Library", distance: "3 min", details: "Coffee + study space"},
                        {name: "Quick review session", location: "Nearby building", distance: "1 min", details: "Go over notes"}
                    ]
                });
            } else {
                suggestions.push({
                    title: '‚ö° Quick Break',
                    items: [
                        {name: "Head to next location early", location: gap.toBuilding, distance: "varies", details: "Get a good seat"},
                        {name: "Bathroom & water break", location: "Current building", distance: "1 min", details: "Stay refreshed"}
                    ]
                });
            }
            return suggestions;
        }

        function showRecurringModal() {
            document.getElementById('copyFromDay').textContent = currentDay;
            document.getElementById('recurringModal').classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        function copySchedule() {
            const sourceSchedule = schedule[currentDay] || [];
            if (sourceSchedule.length === 0) {
                alert('No items to copy from ' + currentDay);
                return;
            }

            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
            let copiedCount = 0;

            days.forEach(day => {
                const checkbox = document.querySelector(`input[value="${day}"]`);
                if (checkbox?.checked && day !== currentDay) {
                    schedule[day] = JSON.parse(JSON.stringify(sourceSchedule));
                    copiedCount++;
                }
            });

            saveSchedule();
            closeModal('recurringModal');
            updateDisplay();
            alert(`‚úÖ Schedule copied to ${copiedCount} day(s)!`);
        }

        async function fetchCampusEvents() {
            lastEventFetch = Date.now();
            cachedEvents = [
                {
                    name: "Visit Temple NOW for Live Events",
                    date: "Daily Updates",
                    time: "Various times",
                    location: "Temple Campus",
                    description: "Click 'View Details' to see current campus events",
                    url: "https://now.temple.edu/events"
                }
            ];
            document.getElementById('campusEvents').textContent = cachedEvents.length;
            updateLastUpdatedTime();
        }

        function updateLastUpdatedTime() {
            const elem = document.getElementById('lastUpdated');
            if (elem) {
                elem.textContent = `Updated at ${new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })}`;
            }
        }

        async function refreshEvents() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'üîÑ Refreshing...';
            await fetchCampusEvents();
            await showCampusEvents();
            btn.disabled = false;
            btn.textContent = 'üîÑ Refresh Events';
        }

        async function showCampusEvents() {
            document.getElementById('eventsModal').classList.add('show');
            const events = cachedEvents || await fetchCampusEvents();
            const container = document.getElementById('eventsList');
            
            container.innerHTML = events.map(event => `
                <div class="event-card">
                    <h3>${event.name}</h3>
                    <p>üìÖ ${event.date}</p>
                    ${event.time !== 'View on website' ? `<p>üïê ${event.time}</p>` : ''}
                    <p>üìç ${event.location}</p>
                    <p style="margin-top: 10px; opacity: 0.9; font-size: 0.95rem;">${event.description}</p>
                    ${event.url ? `
                        <div style="margin-top: 15px;">
                            <button onclick="window.open('${event.url}', '_blank');" 
                                    style="background: white; color: #f59e0b; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                üîó View Details
                            </button>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function showCampusServices() {
            const container = document.getElementById('servicesList');
            container.innerHTML = campusServices.map(service => `
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 16px; margin-bottom: 15px; color: white;">
                    <h3 style="margin-bottom: 10px;">${service.name}</h3>
                    <p style="opacity: 0.95; margin-bottom: 8px;">${service.description}</p>
                    <p style="font-size: 0.9rem; opacity: 0.9;">üìç ${service.location}</p>
                    <p style="font-size: 0.9rem; opacity: 0.9;">üïê ${service.hours}</p>
                    ${service.phone ? `<p style="font-size: 0.9rem; opacity: 0.9;">üìû ${service.phone}</p>` : ''}
                    <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.2);">
                        <p style="font-size: 0.85rem; font-weight: 600; margin-bottom: 8px;">Services:</p>
                        <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                            ${service.services.map(s => `<span style="background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 12px; font-size: 0.8rem;">${s}</span>`).join('')}
                        </div>
                    </div>
                    <button onclick="window.open('${service.bookingUrl}', '_blank')" 
                            style="margin-top: 15px; background: white; color: #667eea; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 600; width: 100%;">
                        üìÖ Book Appointment
                    </button>
                </div>
            `).join('');
            document.getElementById('servicesModal').classList.add('show');
        }

        function showDietaryPreferences() {
            // Load saved preferences
            Object.keys(dietaryPreferences).forEach(pref => {
                const checkbox = document.getElementById(pref + 'Check');
                if (checkbox) checkbox.checked = dietaryPreferences[pref];
            });
            document.getElementById('dietaryModal').classList.add('show');
        }

        function showFoodOptions() {
            let filtered = foodPlaces.filter(place => {
                // Price filter
                if (priceFilter !== 'all' && place.priceRange !== priceFilter) return false;
                
                // Meal plan filter
                if (mealPlanOnly && !place.mealPlan) return false;
                
                // Dietary filters
                const activeDietary = Object.keys(dietaryPreferences).filter(k => dietaryPreferences[k]);
                if (activeDietary.length > 0) {
                    return activeDietary.some(diet => place.dietary && place.dietary.includes(diet));
                }
                
                return true;
            });

            const container = document.getElementById('foodList');
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <p style="color: #6b7280;">No food options match your filters. Try adjusting your preferences!</p>
                    </div>
                `;
                document.getElementById('foodModal').classList.add('show');
                return;
            }

            container.innerHTML = filtered.map(place => {
                const dietaryTags = place.dietary ? place.dietary.map(d => {
                    const icons = {
                        halal: 'üïå',
                        kosher: '‚ú°Ô∏è',
                        vegetarian: 'ü•ó',
                        vegan: 'üå±',
                        glutenFree: 'üåæ',
                        dairyFree: 'ü•õ'
                    };
                    const labels = {
                        halal: 'Halal',
                        kosher: 'Kosher',
                        vegetarian: 'Vegetarian',
                        vegan: 'Vegan',
                        glutenFree: 'Gluten-Free',
                        dairyFree: 'Dairy-Free'
                    };
                    return `<span style="background: rgba(255,255,255,0.3); padding: 3px 8px; border-radius: 10px; font-size: 0.75rem; margin-right: 4px;">${icons[d]} ${labels[d]}</span>`;
                }).join('') : '';

                return `
                    <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 20px; border-radius: 16px; margin-bottom: 15px; color: white;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px; flex-wrap: wrap; gap: 10px;">
                            <h3 style="margin: 0;">${place.name}</h3>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <span style="background: rgba(255,255,255,0.3); padding: 4px 12px; border-radius: 12px; font-size: 0.85rem; font-weight: 600;">${place.priceRange}</span>
                                ${place.mealPlan ? '<span style="background: rgba(255,215,0,0.9); color: #1f2937; padding: 4px 12px; border-radius: 12px; font-size: 0.85rem; font-weight: 600;">üí≥ Meal Plan</span>' : ''}
                            </div>
                        </div>
                        
                        <p style="opacity: 0.95; margin-bottom: 8px; font-weight: 600;">${place.type}</p>
                        <p style="font-size: 0.9rem; opacity: 0.9;">üìç ${place.location}</p>
                        <p style="font-size: 0.9rem; opacity: 0.9;">üïê ${place.hours}</p>
                        ${place.phone ? `<p style="font-size: 0.9rem; opacity: 0.9;">üìû ${place.phone}</p>` : ''}
                        
                        ${dietaryTags ? `
                            <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.2);">
                                ${dietaryTags}
                            </div>
                        ` : ''}
                        
                        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.2);">
                            <p style="font-size: 0.85rem; font-weight: 600; margin-bottom: 8px;">Menu Highlights:</p>
                            <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                                ${place.options.map(opt => `<span style="background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 12px; font-size: 0.8rem;">${opt}</span>`).join('')}
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                            ${place.orderUrl ? `
                                <button onclick="window.open('${place.orderUrl}', '_blank')" 
                                        style="background: white; color: #10b981; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 600; flex: 1;">
                                    üçî Order Ahead
                                </button>
                            ` : `
                                <button disabled 
                                        style="background: rgba(255,255,255,0.3); color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: not-allowed; font-weight: 600; flex: 1;">
                                    Walk-in Only
                                </button>
                            `}
                            <button onclick="openMaps('${place.location}')" 
                                    style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 600;">
                                üó∫Ô∏è Directions
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            document.getElementById('foodModal').classList.add('show');
        }

        function exportSchedule() {
            const dataStr = JSON.stringify(schedule, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'temple-schedule-pro.json';
            link.click();
        }

        function importSchedule() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = event => {
                    try {
                        schedule = JSON.parse(event.target.result);
                        saveSchedule();
                        updateDisplay();
                        alert('‚úÖ Schedule imported successfully!');
                    } catch (error) {
                        alert('‚ùå Error importing schedule.');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        async function fetchFitnessClasses() {
            // Fallback fitness classes - real scraping would need CORS proxy
            return [
                {
                    name: "Yoga Flow",
                    time: "Mon/Wed: 6:00 PM",
                    location: "Pearson Hall Studio",
                    instructor: "Various"
                },
                {
                    name: "HIIT Training",
                    time: "Tue/Thu: 7:00 AM",
                    location: "IBC Fitness Center",
                    instructor: "Various"
                },
                {
                    name: "Spin Class",
                    time: "Mon/Wed/Fri: 5:30 PM",
                    location: "IBC Cycle Studio",
                    instructor: "Various"
                },
                {
                    name: "Zumba",
                    time: "Tue/Thu: 6:30 PM",
                    location: "Pearson Hall Studio",
                    instructor: "Various"
                },
                {
                    name: "Pilates",
                    time: "Wed/Fri: 12:00 PM",
                    location: "Pearson Hall Studio",
                    instructor: "Various"
                },
                {
                    name: "Kickboxing",
                    time: "Mon/Wed: 7:00 PM",
                    location: "IBC Fitness Center",
                    instructor: "Various"
                },
                {
                    name: "Barre",
                    time: "Tue/Thu: 5:00 PM",
                    location: "Pearson Hall Studio",
                    instructor: "Various"
                },
                {
                    name: "Boot Camp",
                    time: "Mon/Wed/Fri: 6:00 AM",
                    location: "IBC Fitness Center",
                    instructor: "Various"
                },
                {
                    name: "View Full Schedule",
                    time: "Updated Weekly",
                    location: "Temple Campus Recreation",
                    url: "https://www.temple.edu/campus-recreation/fitness-wellness/group-fitness/group-fitness-schedule"
                }
            ];
        }

        async function showFitnessClasses() {
            const loadingHTML = '<div style="text-align: center; padding: 40px;"><div style="display: inline-block; width: 40px; height: 40px; border: 4px solid #e5e7eb; border-radius: 50%; border-top-color: #667eea; animation: spin 1s linear infinite;"></div><p style="margin-top: 20px; color: #6b7280;">Loading fitness classes...</p></div>';
            
            document.getElementById('fitnessList').innerHTML = loadingHTML;
            document.getElementById('fitnessModal').classList.add('show');
            
            const classes = await fetchFitnessClasses();
            const container = document.getElementById('fitnessList');
            
            container.innerHTML = classes.map(cls => `
                <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); padding: 20px; border-radius: 16px; margin-bottom: 15px; color: white;">
                    <h3 style="margin-bottom: 10px;">${cls.name}</h3>
                    <p style="font-size: 0.95rem; opacity: 0.95;">üïê ${cls.time}</p>
                    <p style="font-size: 0.95rem; opacity: 0.95;">üìç ${cls.location}</p>
                    ${cls.instructor ? `<p style="font-size: 0.95rem; opacity: 0.95;">üë§ ${cls.instructor}</p>` : ''}
                    
                    <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                        ${cls.url ? `
                            <button onclick="window.open('${cls.url}', '_blank')" 
                                    style="background: white; color: #f59e0b; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 600; flex: 1;">
                                üìÖ View Full Schedule
                            </button>
                        ` : `
                            <button onclick="addEventToSchedule('${cls.name.replace(/'/g, "\\'")}', '${cls.location.replace(/'/g, "\\'")}')" 
                                    style="background: white; color: #f59e0b; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 600; flex: 1;">
                                ‚ûï Add to Schedule
                            </button>
                        `}
                        ${!cls.url ? `
                            <button onclick="openMaps('${cls.location}')" 
                                    style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 600;">
                                üó∫Ô∏è Directions
                            </button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        async function refreshFitnessClasses() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'üîÑ Refreshing...';
            
            await showFitnessClasses();
            
            btn.disabled = false;
            btn.textContent = 'üîÑ Refresh Schedule';
        }

        function addEventToSchedule(name, location) {
            closeModal('eventsModal');
            closeModal('fitnessModal');
            
            // Pre-fill the form
            selectType('event');
            document.getElementById('itemName').value = name;
            
            // Try to find matching building
            const buildingSelect = document.getElementById('building');
            for (let option of buildingSelect.options) {
                if (location.toLowerCase().includes(option.value.toLowerCase()) || 
                    option.value.toLowerCase().includes(location.toLowerCase())) {
                    buildingSelect.value = option.value;
                    break;
                }
            }
            
            // If no match found, use default
            if (!buildingSelect.value) {
                buildingSelect.value = 'Howard Gittis Student Center';
            }
            
            // Scroll to form
            document.getElementById('itemName').scrollIntoView({ behavior: 'smooth', block: 'center' });
            document.getElementById('itemName').focus();
            
            // Show notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                color: white;
                padding: 16px 24px;
                border-radius: 12px;
                box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
                z-index: 10000;
                animation: slideIn 0.3s ease-out;
            `;
            notification.innerHTML = `
                <strong>‚úÖ Event Pre-filled!</strong><br>
                <span style="font-size: 0.9rem;">Fill in the time and add to your schedule</span>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        init();
    </script>
</body>
</html>